{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport { Spinner } from 'spin.js';\n\nlet searchQuery = null;\nlet page = 1;\nconst perPage = 12;\n\naxios.defaults.baseURL = 'https://api.unsplash.com';\naxios.defaults.headers.common['Authorization'] =\n  'Client-ID LxvKVGJqiSe6NcEVZOaLXC-f2JIIWZaq_o0WrF8mwJc';\n\nfunction getPhotos(query, page = 1, perPage) {\n  return axios.get('/search/photos', {\n    params: {\n      query,\n      orientation: 'portrait',\n      page,\n      per_page: perPage,\n    },\n  });\n}\n\nconst opts = {\n  lines: 20, // The number of lines to draw\n  length: 79, // The length of each line\n  width: 17, // The line thickness\n  radius: 54, // The radius of the inner circle\n  scale: 0.45, // Scales overall size of the spinner\n  corners: 0.6, // Corner roundness (0..1)\n  speed: 1.6, // Rounds per second\n  rotate: 44, // The rotation offset\n  animation: 'spinner-line-fade-quick', // The CSS animation name for the lines\n  direction: 1, // 1: clockwise, -1: counterclockwise\n  color: '#89ff57', // CSS color or array of colors\n  fadeColor: 'transparent', // CSS color or array of colors\n  top: '54%', // Top position relative to parent\n  left: '50%', // Left position relative to parent\n  shadow: '0 0 2px transparent', // Box-shadow for the lines\n  zIndex: 2000000000, // The z-index (defaults to 2e9)\n  className: 'spinner', // The CSS class to assign to the spinner\n  position: 'absolute', // Element positioning\n};\n\nconst spinnerContainer = document.querySelector('.js-backdrop');\nconst spinner = new Spinner(opts);\n\nconst options = {\n  root: null,\n  rootMargin: '100px',\n  threshold: 1.0,\n};\n\nconst callback = function (entries, observer) {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      observer.unobserve(entry.target);\n      loadMoreData();\n    }\n  });\n};\n\nconst observer = new IntersectionObserver(callback, options);\n\nconst formEl = document.querySelector('.js-search-form');\nconst listEl = document.querySelector('.js-gallery');\n\nformEl.addEventListener('submit', onSubmit);\n\nasync function onSubmit(event) {\n  event.preventDefault();\n  spinnerPlay();\n\n  searchQuery = event.currentTarget.elements['user-search-query'].value.trim();\n\n  page = 1;\n\n  try {\n    const {\n      data: { results, total_pages },\n    } = await getPhotos(searchQuery, page, perPage);\n    if (results.length === 0) {\n      iziToast.error({\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n      });\n    }\n    console.log(results);\n    listEl.innerHTML = createMarkup(results);\n\n    hasMoreData(total_pages);\n  } catch (error) {\n    console.log(error);\n  } finally {\n    spinnerStop();\n  }\n}\nasync function loadMoreData() {\n  page += 1;\n\n  spinnerPlay();\n\n  try {\n    const {\n      data: { results, total_pages },\n    } = await getPhotos(searchQuery, page, perPage);\n\n    listEl.insertAdjacentHTML('beforeend', createMarkup(results));\n\n    hasMoreData(total_pages);\n  } catch (error) {\n    console.log(error);\n  } finally {\n    spinnerStop();\n  }\n}\n\nfunction createMarkup(arr) {\n  return arr\n    .map(item => {\n      return `<li class='gallery__item'>\n    <img src='${item.urls.small}' alt='${item.alt_description}' class='gallery-img' />\n  </li>`;\n    })\n    .join('');\n}\n\nfunction spinnerPlay() {\n  spinner.spin(spinnerContainer);\n  spinnerContainer.classList.remove('is-hidden');\n}\n\nfunction spinnerStop() {\n  spinner.stop();\n  spinnerContainer.classList.add('is-hidden');\n}\n\nfunction hasMoreData(lastPage) {\n  if (page < lastPage) {\n    const item = document.querySelector('.gallery__item:last-child');\n    observer.observe(item);\n  } else {\n    iziToast.error({\n      message: \" We're sorry, but you've reached the end of search results.\",\n    });\n  }\n}\n"],"names":["searchQuery","page","perPage","axios","getPhotos","query","opts","spinnerContainer","spinner","Spinner","options","callback","entries","observer","entry","loadMoreData","formEl","listEl","onSubmit","event","spinnerPlay","results","total_pages","iziToast","createMarkup","hasMoreData","error","spinnerStop","arr","item","lastPage"],"mappings":"owBAKA,IAAIA,EAAc,KACdC,EAAO,EACX,MAAMC,EAAU,GAEhBC,EAAM,SAAS,QAAU,2BACzBA,EAAM,SAAS,QAAQ,OAAO,cAC5B,wDAEF,SAASC,EAAUC,EAAOJ,EAAO,EAAGC,EAAS,CAC3C,OAAOC,EAAM,IAAI,iBAAkB,CACjC,OAAQ,CACN,MAAAE,EACA,YAAa,WACb,KAAAJ,EACA,SAAUC,CACX,CACL,CAAG,CACH,CAEA,MAAMI,EAAO,CACX,MAAO,GACP,OAAQ,GACR,MAAO,GACP,OAAQ,GACR,MAAO,IACP,QAAS,GACT,MAAO,IACP,OAAQ,GACR,UAAW,0BACX,UAAW,EACX,MAAO,UACP,UAAW,cACX,IAAK,MACL,KAAM,MACN,OAAQ,sBACR,OAAQ,IACR,UAAW,UACX,SAAU,UACZ,EAEMC,EAAmB,SAAS,cAAc,cAAc,EACxDC,EAAU,IAAIC,EAAQH,CAAI,EAE1BI,EAAU,CACd,KAAM,KACN,WAAY,QACZ,UAAW,CACb,EAEMC,EAAW,SAAUC,EAASC,EAAU,CAC5CD,EAAQ,QAAQE,GAAS,CACnBA,EAAM,iBACRD,EAAS,UAAUC,EAAM,MAAM,EAC/BC,IAEN,CAAG,CACH,EAEMF,EAAW,IAAI,qBAAqBF,EAAUD,CAAO,EAErDM,EAAS,SAAS,cAAc,iBAAiB,EACjDC,EAAS,SAAS,cAAc,aAAa,EAEnDD,EAAO,iBAAiB,SAAUE,CAAQ,EAE1C,eAAeA,EAASC,EAAO,CAC7BA,EAAM,eAAc,EACpBC,IAEApB,EAAcmB,EAAM,cAAc,SAAS,qBAAqB,MAAM,OAEtElB,EAAO,EAEP,GAAI,CACF,KAAM,CACJ,KAAM,CAAE,QAAAoB,EAAS,YAAAC,CAAa,CAC/B,EAAG,MAAMlB,EAAUJ,EAAaC,EAAMC,CAAO,EAC1CmB,EAAQ,SAAW,GACrBE,EAAS,MAAM,CACb,QACE,0EACV,CAAO,EAEH,QAAQ,IAAIF,CAAO,EACnBJ,EAAO,UAAYO,EAAaH,CAAO,EAEvCI,EAAYH,CAAW,CACxB,OAAQI,EAAP,CACA,QAAQ,IAAIA,CAAK,CACrB,QAAY,CACRC,GACD,CACH,CACA,eAAeZ,GAAe,CAC5Bd,GAAQ,EAERmB,IAEA,GAAI,CACF,KAAM,CACJ,KAAM,CAAE,QAAAC,EAAS,YAAAC,CAAa,CAC/B,EAAG,MAAMlB,EAAUJ,EAAaC,EAAMC,CAAO,EAE9Ce,EAAO,mBAAmB,YAAaO,EAAaH,CAAO,CAAC,EAE5DI,EAAYH,CAAW,CACxB,OAAQI,EAAP,CACA,QAAQ,IAAIA,CAAK,CACrB,QAAY,CACRC,GACD,CACH,CAEA,SAASH,EAAaI,EAAK,CACzB,OAAOA,EACJ,IAAIC,GACI;AAAA,gBACGA,EAAK,KAAK,eAAeA,EAAK;AAAA,QAEzC,EACA,KAAK,EAAE,CACZ,CAEA,SAAST,GAAc,CACrBZ,EAAQ,KAAKD,CAAgB,EAC7BA,EAAiB,UAAU,OAAO,WAAW,CAC/C,CAEA,SAASoB,GAAc,CACrBnB,EAAQ,KAAI,EACZD,EAAiB,UAAU,IAAI,WAAW,CAC5C,CAEA,SAASkB,EAAYK,EAAU,CAC7B,GAAI7B,EAAO6B,EAAU,CACnB,MAAMD,EAAO,SAAS,cAAc,2BAA2B,EAC/DhB,EAAS,QAAQgB,CAAI,CACzB,MACIN,EAAS,MAAM,CACb,QAAS,6DACf,CAAK,CAEL"}